/*
 * main.c
 *
 *  Created on: ??þ/??þ/????
 *      Author: Abdo2
 */
#include"STD_TYPES.h"
#include"BIT_MATH.h"
#include"DIO_interface.h"
#include"TIMER0_int.h"
#include"TIMER0_register.h"
#include"EXT_INTERRUPT_int.h"
#include"util/delay.h"

void PRINT_STRING(u8 data);

const u8 CHARACTER_MATRIX_NEW[38][9]={
		{0x00,0x7e,0x90,0x90,0x90,0x90,0x90,0x7e,0x00},   // A 0x41 65
		{0x00,0x7f,0x91,0x91,0x91,0x91,0x91,0x66,0x00},   // B 0x42 66
		{0x00,0x7e,0x81,0x81,0x81,0x81,0x81,0x00,0x00},   // C 0x43 67
		{0x00,0xff,0x81,0x81,0x81,0x81,0x42,0x3c,0x00},   // D 0x44 68
		{0x00,0xFf,0x89,0x89,0x89,0x81,0x81,0x81,0x00},   // E 0x45 69
		{0x00,0xFf,0x88,0x88,0x88,0x80,0x80,0x80,0x00},   // F 0x46 70
		{0x00,0x7e,0x81,0x81,0x89,0x8f,0x80,0x60,0x00},   // G 0x47 71
		{0x00,0xff,0x08,0x08,0x08,0x08,0x08,0xff,0x00},   // H 0x48 72
		{0x00,0x00,0x81,0x81,0xff,0x81,0x81,0x00,0x00},   // I 0x49 73
		{0x00,0x02,0x81,0x81,0xfe,0x80,0x80,0x00,0x00},   // J 0x4a 74
		{0x00,0xff,0x18,0x24,0x42,0x81,0x01,0x00,0x00},   // K 0x4b 75
		{0x00,0xff,0x01,0x01,0x01,0x01,0x00,0x00,0x00},   // L 0x4c 76
		{0x00,0xff,0x80,0x40,0x20,0x40,0x80,0xff,0x00},   // M 0x4d 77
		{0x00,0xfe,0x04,0x08,0x10,0x20,0x40,0xfe,0x00},   // N 0x4e 78
		{0x00,0x7e,0x81,0x81,0x81,0x81,0x81,0x7e,0x00},   // O 0x4f 79
		{0x00,0xff,0x90,0x90,0x90,0x90,0x90,0x60,0x00},   // P 0x50 80
		{0x00,0x7B,0x82,0x82,0x8A,0x86,0x82,0x7C,0x00},   // Q 0x51 81
		{0x00,0xff,0x90,0x98,0x94,0x92,0x91,0x61,0x00},   // R 0x52 82
		{0x00,0x42,0xA1,0x91,0x89,0x85,0x81,0x82,0x00},   // S 0x53 83
		{0x00,0x80,0x80,0x80,0xff,0x80,0x80,0x80,0x00},   // T 0x54 84
		{0x00,0xfe,0x01,0x01,0x01,0x01,0x01,0xfe,0x00},   // U 0x55 85
		{0x00,0x18,0x04,0x02,0x01,0x02,0x04,0x18,0x00},   // V 0x56 86
		{0x00,0xff,0x02,0x04,0x08,0x04,0x02,0xff,0x00},   // W 0x57 87
		{0x00,0x81,0x42,0x24,0x10,0x24,0x42,0x81,0x00},   // X 0x58 88
		{0x00,0x80,0x40,0x20,0x1f,0x20,0x40,0x80,0x00},   // Y 0x59 89
		{0x00,0x82,0x86,0x8A,0x92,0xA2,0xC2,0x82,0x00},   // Z 0x5a 90
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},   // space  91

		{0x00,0xff,0x81,0x81,0x81,0x81,0x81,0xff,0x00},   // 0 0x30 92
		{0x00,0x00,0x41,0x41,0xff,0x01,0x01,0x00,0x00},   // 1 0x31 93
		{0x00,0x00,0x01,0x43,0x85,0x89,0x91,0x61,0x00},   // 2 0x32 94
		{0x00,0x00,0x00,0x02,0x91,0x91,0x92,0x6C,0x00},   // 3 0x33 95
		{0x00,0x08,0x18,0x28,0x48,0xff,0x08,0x00,0x00},   // 4 0x34 96
		{0x01,0xf1,0x91,0x91,0x91,0x9f,0x80,0x80,0x00},   // 5 0x35 97
		{0x00,0xff,0x91,0x91,0x91,0x9f,0x00,0x00,0x00},   // 6 0x36 98
		{0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x7f,0x00},   // 7 0x37 99
		{0x00,0xff,0x91,0x91,0x91,0x91,0x91,0xff,0x00},   // 8 0x38 100
		{0x00,0xff,0x81,0x81,0x81,0x81,0x81,0xff,0x00},   // 9 0x39 101
		{0x00,0x00,0x00,0xe7,0xe7,0xe7,0x00,0x00,0x00},   // : 0x3a 102

};
u8 Display_String[] = "ABDO";


u8 Display_String_nums_ABDO[] = {65 ,66 ,68 ,79 };	//ABDO
u8 Display_String_nums_OSAMA[] = {79 ,83 ,65 ,77 ,65};//OSAMA
u8 Display_String_nums_SHYMAA[] = {83 ,72 ,89 ,77 ,65 ,65};//SHYMAA
u8 Display_String_nums_ARWA[] = {65 ,82 ,87 ,65 };//ARWA
u8 Display_String_nums_ITI[] = {84 ,72 ,65 ,78 ,75 ,83 , 91,73 ,84 ,73 };//THANKS ITI
u8 Display_String_nums_OTHMAN[] = {65 ,91 ,79 ,84 ,72 ,77 ,65 ,78 };//A OTHMAN
u8 Display_String_nums_AMGAD[] = {65 ,77 ,71 ,65 ,68 };//AMGAD
u8 Display_String_nums_HESHAM[] = {72 ,69 ,83 ,72 ,65 ,77 };//HESHAM
volatile u8 Display_String_nums_clock[] = {92 ,98 ,102 ,94 ,97 ,102 ,96 ,93 };//06:25:41

u8 char_length = 9;
u8 i =0 ,j =0 ;

const u8 leds_number = 8;
const u8 max_cycle = 35 ;
const u16 resolution = 164 ;

volatile u16 TIMER0_Overflows =0 ;
volatile u8 cycles =0;
volatile u32 cycle_time =0;
volatile u32 resolution_time =350;

void EXTI0_ISR(void)
{
	cycles ++ ;
	if(cycles == max_cycle)
	{
		cycles = 0 ;
		cycle_time=(TCNT0_REG + (TIMER0_Overflows * 256))/(max_cycle);
		TCNT0_REG_LOAD(0);
		TIMER0_Overflows = 0 ;
		resolution_time = cycle_time/resolution;
	}
}

void TIMER0_ISR (void)
{
	TIMER0_Overflows ++ ;
}

int main ()
{
	u8 k =0 ;
	u32 time =0 ;
	DIO_voidSetportDirection(PORTA ,PORT_OUT);
	DIO_voidSetportValue(PORTA , 0);

	DIO_voidSetpinDirection(PORTD ,PIN2 ,IN );
	DIO_voidSetpinValue(PORTD,PIN2,HIGH);

	CALLback_EXT0(EXTI0_ISR);
	CALLback_TIMER0V(TIMER0_ISR);

	EXT_VoidInit(EXTI0 , FALLING_EDGE ,INTERRUPT);
	TIMER0_INIT(NORMAL , FCPU8 , INTERRUPTOV , 0 , 0 ,OCO0_DISABLE);

	while(1)
	{

		/********************************************************************************/

					for (k=0;k<8;k++)
					{
						PRINT_STRING(Display_String_nums_clock[k]);
					}

					for (k=0;k<3;k++)
					{
						PRINT_STRING(91);
					}


		/********************************************************************************/

	}
	return 0 ;
}

void PRINT_STRING(u8 data)
{


	if (data < 65 || data > 102)
	{
		data = 91;
	}
	data -= 65;

	for (i=0;i<char_length; i++)
	{
		u8 temp_data = CHARACTER_MATRIX_NEW[data][i];

		DIO_voidSetportValue(PORTA ,temp_data) ;
		_delay_us(resolution_time * 2);
/*
		_delay_ms(1000);
		DIO_voidSetportValue(PORTA ,PORT_IN) ;
		_delay_ms(1000);
*/

	}

	DIO_voidSetportValue(PORTA ,PORT_IN) ;
	_delay_us(resolution_time*6);

}
